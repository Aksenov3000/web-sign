<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Vite + TS</title>
	<link href="data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBQAAFgAAACgAAAAQAAAAIAAAAAEACAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP//AAD8fwAA/H8AAPxjAAD/4wAA/+MAAMY/AADGPwAAxjEAAP/xAAD/8QAA4x8AAOMfAADjHwAA//8AAP//AAA=" rel="icon" type="image/x-icon">
</head>
<body>
	<table style="width:100%">
		<tr>
			<th>Динамика</th>
			<th>Статика</th>
		</tr>
		<tr>
			<td>
				<textarea id="txDynCerts" style="width: 100%; height: 600px;"></textarea>
			</td>
			<td>
				<textarea id="txStatCerts" style="width: 100%; height: 600px"></textarea>
			</td>
		</tr>
		<tr>
			<td>
				<button id="btStart" type="button">Старт</button>
				<button id="btStop" type="button">Стоп</button>
			</td>
			<td>
				<button id="btAquire" type="button">Получить</button>
			</td>
		</tr>
		<tr>
			<td colspan="2">
				<textarea id="txErrors" style="width:100%; height:300px; scroll-behavior:auto"></textarea>
			</td>
		</tr>
	</table>
	<div id="app"></div>
	<script type="module" src="/src/index.ts"></script>
	<script>
		var ws = undefined;
		window.addEventListener('load', (event) =>
		{
			ws = window.WebSign;
			if (!ws)
			{
				var tx = document.getElementById("txErrors");
				tx.value = tx.value + "\nWebSign do not installed";
				return;
			}
            ws.OnCertificateAdd.subscribe((certificate, eventManagement) =>
			{
				var tx = document.getElementById("txDynCerts");
				tx.value = tx.value + "\n[" + certificate.id + "]";
				eventManagement.propogationStopped = false;
			});
            ws.OnLog.subscribe((log) =>
			{
				var level = "undefined";
				switch (log.Level) {
					case 1: level = "Debug"; break;
                    case 2: level = "Warning"; break;
                    case 3: level = "Error"; break;
				}
                var mess = log.Library + "-" + level + "-" + window.WebSignLogMessages.Language.get("ru").get(log.Code) + (log.Exception ? " - " + log.Exception : "");
				var tx = document.getElementById("txErrors");
                tx.value = tx.value + "\n" + mess;
			});
            ws.OnCertificateRemove.subscribe((certificate) =>
			{
				var tx = document.getElementById("txDynCerts");
				tx.value = tx.value.replace("\n[" + certificate.id + "]", "");
			});
		});
		document.getElementById("btStart").addEventListener('click', (event) =>
		{
			var tx = document.getElementById("txDynCerts");
			tx.value = "";

			if (ws) ws.startCertificateScan();
		});
		document.getElementById("btStop").addEventListener('click', (event) =>
		{
			if (ws) ws.stopCertificateScan();
		});
	</script>
</body>
</html>
